<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard - Hourly View</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background: linear-gradient(135deg, #f0f9ff 0%, #e1ffeb 100%); min-height: 100vh; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <header class="mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="text-center md:text-left">
                <h1 class="text-3xl font-bold text-gray-800">üïí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</h1>
                <p id="displaySelectedDate" class="text-lg text-blue-600 font-semibold mt-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
            </div>
            
           <button onclick="window.location.href='index.html'"></button>
class="bg-white hover:bg-gray-100 text-gray-700 font-semibold py-2 px-6 rounded-...
‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
</button>
        </header>

        <div class="bg-white p-6 rounded-3xl shadow-md mb-8 border border-green-100">
            <div class="w-full max-w-md mx-auto">
                <label class="block text-xs font-bold text-green-700 mb-2 uppercase">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                <select id="hourSelector" onchange="displayData()" class="w-full bg-gray-50 border border-green-200 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-green-400 text-lg font-bold">
                    <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ --</option>
                </select>
            </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="glass-card p-6 rounded-2xl shadow-sm border-t-4 border-orange-400 text-center"><p class="text-gray-500 text-sm">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</p><h2 id="valTemp" class="text-3xl font-bold text-orange-600">-- ¬∞C</h2></div>
            <div class="glass-card p-6 rounded-2xl shadow-sm border-t-4 border-blue-400 text-center"><p class="text-gray-500 text-sm">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</p><h2 id="valHum" class="text-3xl font-bold text-blue-600">-- %</h2></div>
            <div class="glass-card p-6 rounded-2xl shadow-sm border-t-4 border-purple-400 text-center"><p class="text-gray-500 text-sm">VPD</p><h2 id="valVPD" class="text-3xl font-bold text-purple-600">--</h2></div>
            <div class="glass-card p-6 rounded-2xl shadow-sm border-t-4 border-teal-400 text-center"><p class="text-gray-500 text-sm">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ù‡∏ô</p><h2 id="valRain" class="text-3xl font-bold text-teal-600">-- mm</h2></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="glass-card p-4 rounded-2xl h-64"><canvas id="chartTemp"></canvas></div>
            <div class="glass-card p-4 rounded-2xl h-64"><canvas id="chartHumid"></canvas></div>
            <div class="glass-card p-4 rounded-2xl h-64"><canvas id="chartVpd"></canvas></div>
            <div class="glass-card p-4 rounded-2xl h-64"><canvas id="chartRain"></canvas></div>
        </div>
    </div>

<script>
let hourlyRecords = [];
let charts = {};
let selectedDate = "";

window.onload = function() {
    selectedDate = localStorage.getItem('selectedTargetDate'); 
    const rawData = localStorage.getItem('sharedWeatherData'); 

    if (!selectedDate || !rawData) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏Å‡πà‡∏≠‡∏ô!");
        window.location.href = 'http://127.0.0.1:5500/%E0%B8%97%E0%B8%94%E0%B8%A5%E0%B8%AD%E0%B8%87%20sit%203.html';
        return;
    }

    document.getElementById('displaySelectedDate').innerText = "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: " + selectedDate;
    parseAndFilterData(rawData);
};

function parseAndFilterData(html) {
    const doc = new DOMParser().parseFromString(html, 'text/html');
    const rows = doc.querySelectorAll('tr');
    hourlyRecords = [];
    const hoursFound = new Set();

    rows.forEach(row => {
        const tds = row.querySelectorAll('td');
        if (tds.length >= 5) {
            const fullDateStr = tds[0].innerText.trim();
            if (fullDateStr.startsWith(selectedDate)) {
                const timePart = fullDateStr.split(' ')[1];
                hourlyRecords.push({
                    time: timePart,
                    temp: parseFloat(tds[1].innerText) || 0,
                    vpd: parseFloat(tds[2].innerText) || 0,
                    hum: parseFloat(tds[3].innerText) || 0,
                    rain: parseFloat(tds[4].innerText) || 0
                });
                hoursFound.add(timePart);
            }
        }
    });

    const selector = document.getElementById('hourSelector');
    const sortedHours = Array.from(hoursFound).sort();
    selector.innerHTML = sortedHours.map(h => `<option value="${h}">${h} ‡∏ô.</option>`).join('');
    if(hourlyRecords.length > 0) displayData();
}

function displayData() {
    const currentHour = document.getElementById('hourSelector').value || hourlyRecords[0]?.time;
    const data = hourlyRecords.find(r => r.time === currentHour);
    if (data) {
        document.getElementById('valTemp').innerText = data.temp.toFixed(1) + " ¬∞C";
        document.getElementById('valHum').innerText = data.hum.toFixed(1) + " %RH";
        document.getElementById('valVPD').innerText = data.vpd.toFixed(2) + " kpa";
        document.getElementById('valRain').innerText = data.rain.toFixed(1) + " mm";
        updateBarChart('chartTemp', '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥', data.temp, '#fb923c');
        updateBarChart('chartHumid', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô', data.hum, '#60a5fa');
        updateBarChart('chartVpd', 'VPD', data.vpd, '#c084fc');
        updateBarChart('chartRain', '‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ù‡∏ô', data.rain, '#2dd4bf');
    }
}

function updateBarChart(id, label, val, color) {
    const ctx = document.getElementById(id).getContext('2d');
    if (charts[id]) charts[id].destroy();
    charts[id] = new Chart(ctx, {
        type: 'bar',
        data: { labels: [label], datasets: [{ data: [val], backgroundColor: color, borderRadius: 10, barThickness: 50 }] },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
    });
}
</script>
</body>
</html>
